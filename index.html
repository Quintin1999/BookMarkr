<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BookMarkr</title>
</head>
<body>
    <h1>API Testing Form</h1>

    <!-- Create User -->
    <h2>Create User</h2>
    <form action="http://localhost:3000/api/users/create" method="POST">
        <label for="username">Username:</label>
        <input type="text" name="username" id="username" required><br>

        <label for="email">Email:</label>
        <input type="email" name="email" id="email" required><br>

        <label for="password">Password:</label>
        <input type="password" name="password" id="password" required><br>

        <button type="submit">Create User</button>
    </form>

    <!-- Login -->
    <h2>Login</h2>
    <form id="loginForm">
        <label for="loginEmail">Email:</label>
        <input type="email" id="loginEmail" name="email" required><br>

        <label for="loginPassword">Password:</label>
        <input type="password" id="loginPassword" name="password" required><br>

        <button type="submit">Login</button>
    </form>

    <!-- Create Club -->
    <h2>Create Club</h2>
    <form id="createClubForm">
        <label for="name">Club Name:</label>
        <input type="text" name="name" id="name" required><br>

        <label for="description">Description:</label>
        <input type="text" name="description" id="description"><br>

        <label for="roomKey">Room Key:</label>
        <input type="text" name="roomKey" id="roomKey" required><br>

        <label for="userId">User ID (Owner):</label>
        <input type="text" name="userId" id="userId" required><br>

        <button type="button" id="createClubButton">Create Club</button> <!-- Change to 'button' type -->
    </form>

    <script>
        // Login form submission
        async function submitLoginForm(event) {
            event.preventDefault(); // Prevent default form submission

            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const response = await fetch('http://localhost:3000/api/users/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, password }),  // Send email and password
                });

                const result = await response.json();

                if (response.ok) {
                    // Store the token in localStorage
                    localStorage.setItem('jwtToken', result.token);
                    alert('Login successful');
                    console.log('Token:', result.token);
                } else {
                    alert('Login failed: ' + result.message);
                }
            } catch (error) {
                console.error('Error during login:', error);
                alert('Error during login');
            }
        }

        // Create club form submission
        async function submitCreateClubForm(event) {
            event.preventDefault(); // Prevent default form submission

            const form = document.getElementById('createClubForm');
            const formData = new FormData(form);
            const data = {
                name: formData.get('name'),
                description: formData.get('description'),
                roomKey: formData.get('roomKey'),
                userId: formData.get('userId')
            };

            // Get the token from localStorage
            const token = localStorage.getItem('jwtToken');
            if (!token) {
                alert('No token found. Please login first.');
                return;
            }

            console.log("Submitting create club with data:", data);

            // Send the data to the backend with the Authorization header
            try {
                const response = await fetch('http://localhost:3000/api/club/create', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`,  // Send the JWT token in the header
                    },
                    body: JSON.stringify(data),
                });

                const result = await response.json();
                if (response.ok) {
                    console.log('Club created successfully:', result);
                    alert('Club created successfully!');
                } else {
                    console.error('Error creating club:', result.message);
                    alert('Error creating club: ' + result.message);
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Attach event listeners to forms
        document.getElementById('loginForm').addEventListener('submit', submitLoginForm);
        document.getElementById('createClubButton').addEventListener('click', submitCreateClubForm); // Attach to the correct button
    </script>
</body>
</html>
